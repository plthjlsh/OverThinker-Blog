---
interface Props {
	class?: string;
}

const { class: className = "" } = Astro.props;

// Ëé∑ÂèñÂΩìÂâçÊó•Êúü
const today = new Date();
const currentYear = today.getFullYear();
const currentMonth = today.getMonth();
const currentDate = today.getDate();

// Êúà‰ªΩÂêçÁß∞
const monthNames = [
	"January",
	"February",
	"March",
	"April",
	"May",
	"June",
	"July",
	"August",
	"September",
	"October",
	"November",
	"December",
];

// ÊòüÊúüÂêçÁß∞
const dayNames = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];

// ÁîüÊàêÊó•ÂéÜÊï∞ÊçÆ
function generateCalendar(year: number, month: number) {
	const firstDay = new Date(year, month, 1).getDay();
	const daysInMonth = new Date(year, month + 1, 0).getDate();
	const daysInPrevMonth = new Date(year, month, 0).getDate();

	const calendarDays = [];

	// ‰∏ä‰∏™ÊúàÁöÑÊó•Êúü
	for (let i = firstDay - 1; i >= 0; i--) {
		calendarDays.push({
			day: daysInPrevMonth - i,
			isCurrentMonth: false,
			isToday: false,
		});
	}

	// ÂΩìÂâçÊúàÁöÑÊó•Êúü
	for (let i = 1; i <= daysInMonth; i++) {
		const isToday =
			year === currentYear && month === currentMonth && i === currentDate;
		calendarDays.push({
			day: i,
			isCurrentMonth: true,
			isToday: isToday,
		});
	}

	// ‰∏ã‰∏™ÊúàÁöÑÊó•ÊúüÔºàË°•ÈΩêÂà∞42Â§©Ôºâ
	const remainingDays = 42 - calendarDays.length;
	for (let i = 1; i <= remainingDays; i++) {
		calendarDays.push({
			day: i,
			isCurrentMonth: false,
			isToday: false,
		});
	}

	return calendarDays;
}

const calendarDays = generateCalendar(currentYear, currentMonth);
---

<div class={`bg-[var(--card-bg)] rounded-2xl p-5 shadow-xl border border-green-500/30 sm:p-6 backdrop-blur-sm bg-black/30 ${className}`}>
  <div class="mb-5 sm:mb-6">
    <h2 class="text-xl font-bold text-center text-[var(--text-color)] md:text-2xl lg:text-3xl bg-gradient-to-r from-green-400 to-emerald-500 bg-clip-text text-transparent tracking-wide">
      {monthNames[currentMonth]} {currentYear}
    </h2>
  </div>
  
  <!-- ÊòüÊúüÊ†áÈ¢ò -->
  <div class="grid grid-cols-7 gap-1 mb-3 sm:gap-2 sm:mb-4">
    {dayNames.map((day, index) => (
      <div 
        class="text-center text-[0.7rem] font-extrabold py-2 sm:text-xs sm:py-2.5 md:text-sm md:py-3 rounded-full bg-gradient-to-b from-green-900/40 to-green-800/20 text-emerald-400 border border-green-500/20 backdrop-blur-sm aspect-square flex items-center justify-center transition-transform duration-1000 hover:duration-1500"
        style={`transform: rotate(0deg);`}
        data-hover-rotate={`${(index + 1) * 360}deg`}
      >
        {day}
      </div>
    ))}
  </div>
  
  <!-- Êó•ÂéÜÊó•Êúü -->
  <div class="calendar-grid grid grid-cols-7 gap-1 sm:gap-2 relative">
    {calendarDays.map((date) => (
      <div 
        class={`aspect-square flex items-center justify-center text-[0.8rem] rounded-full transition-all duration-300 sm:text-sm md:text-base cursor-pointer transform hover:scale-110 hover:rotate-12 backdrop-blur-sm border border-transparent
          ${date.isToday 
            ? 'bg-gradient-to-br from-green-600 to-emerald-700 text-white font-extrabold shadow-lg shadow-green-500/40 ring-2 ring-emerald-400/50' 
            : date.isCurrentMonth 
              ? 'text-[var(--text-color)] hover:bg-gradient-to-br from-green-500/20 to-emerald-500/10 hover:shadow-md hover:border-green-500/30 hover:text-emerald-300' 
              : 'opacity-40 hover:opacity-70 hover:text-emerald-400'}
        `}
        style={!date.isToday ? "color: var(--text-color);" : ""}
        data-date={date.day}
        data-current-month={date.isCurrentMonth}
      >
        {date.day}
      </div>
    ))}
  </div>
</div>

<style is:inline>
  /* Scale animation for clicked dates */
  .scale-125 {
    transform: scale(1.25) !important;
    transition: transform 0.3s ease;
  }
  
  /* Ensure the calendar grid has proper positioning for absolute elements */
  .calendar-grid {
    position: relative;
  }
  
  /* Animation for the surprise emojis */
  @keyframes floatUp {
    0% {
      transform: translate(-50%, -50%) scale(0);
      opacity: 0;
    }
    25% {
      transform: translate(-50%, -50%) scale(0.5);
      opacity: 0.3;
    }
    50% {
      transform: translate(-50%, -50%) scale(1) translateY(-10px);
      opacity: 1;
    }
    100% {
      transform: translate(-50%, -50%) translateY(-60px) scale(1.3);
      opacity: 0;
    }
  }
</style>

<script is:inline>
  document.addEventListener('DOMContentLoaded', () => {
    const calendarGrid = document.querySelector('.calendar-grid');
    
    // ‰∏∫ÊòüÊúüÊ†áÈ¢òÊ∑ªÂä†ÊÇ¨ÂÅúÊóãËΩ¨ÊïàÊûú
    const weekHeaders = document.querySelectorAll('[data-hover-rotate]');
    weekHeaders.forEach(header => {
      header.addEventListener('mouseenter', () => {
        const rotateValue = header.getAttribute('data-hover-rotate');
        header.style.transform = `rotate(${rotateValue})`;
      });
      
      header.addEventListener('mouseleave', () => {
        header.style.transform = 'rotate(0deg)';
      });
    });
    
    calendarGrid?.addEventListener('click', (e) => {
      const target = e.target;
      if (target.matches('[data-date][data-current-month="true"]')) {
        // Create surprise effect
        const rect = target.getBoundingClientRect();
        const calendarRect = calendarGrid.getBoundingClientRect();
        
        // Create floating emoji effect
        const emojis = [
          'üéâ', '‚ú®', 'üåü', 'üéä', 'ü•≥', 'üöÄ', 'üéà',
          '‚ù§Ô∏è', 'üíñ', 'üíô', 'üíö', 'üíõ', 'üíú', 'üß°',
          'üî•', '‚≠ê', 'üåà', 'üçï', 'üç¶', 'üéÇ', 'üéÅ',
          'üéÆ', 'üéØ', 'üèÜ', 'ü•á', 'ü•à', 'ü•â', 'üé®',
          'üé≠', 'üé¨', 'üé§', 'üéß', 'üé∏', 'üéπ', 'ü•Å',
          '‚öΩ', 'üèÄ', 'üèà', '‚öæ', 'üéæ', 'üèê', 'üé±',
          'üí°', 'üîë', 'üíé', 'üí∞', 'üí≥', 'üíé', 'üîÆ',
          'üê∂', 'üê±', 'üê≠', 'üêπ', 'üê∞', 'ü¶ä', 'üêª',
          'üêº', 'üê®', 'üêØ', 'ü¶Å', 'üêÆ', 'üê∑', 'üê∏'
        ];
        const randomEmoji = emojis[Math.floor(Math.random() * emojis.length)];
        
        const surprise = document.createElement('div');
        surprise.className = 'absolute text-2xl pointer-events-none z-10';
        surprise.textContent = randomEmoji;
        surprise.style.left = `${rect.left - calendarRect.left + rect.width/2}px`;
        surprise.style.top = `${rect.top - calendarRect.top + rect.height/2}px`;
        surprise.style.transform = 'translate(-50%, -50%)';
        surprise.style.opacity = '0';
        surprise.style.willChange = 'transform, opacity'; // ÊèêÂçáÂä®ÁîªÊÄßËÉΩ
        
        // Add CSS animation class
        surprise.style.animation = 'floatUp 1.2s cubic-bezier(0.34, 1.56, 0.64, 1) forwards';
        
        calendarGrid.appendChild(surprise);
        
        // ‰ΩøÁî®requestAnimationFrameÁ°Æ‰øùÂÖÉÁ¥†Ë¢´Ê≠£Á°ÆÊ∑ªÂä†Âà∞DOMÂêéÂÜçËß¶ÂèëÂä®Áîª
        requestAnimationFrame(() => {
          surprise.style.opacity = '1';
        });
        
        // Remove the surprise element after animation completes
        setTimeout(() => {
          surprise.remove();
        }, 1200);
        
        // Add pulse effect to the clicked date
        target.classList.add('scale-125');
        setTimeout(() => {
          target.classList.remove('scale-125');
        }, 300);
      }
    });
  });
</script>

